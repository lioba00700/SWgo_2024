
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- 메타 태그 설정: 문자 인코딩, 뷰포트, 등 -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Chart.js 라이브러리 링크 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- 페이지 제목 -->
    <title>what is my dog?</title>

    <!-- CSS 스타일 정의 -->
    <style>
        /* body 태그에 대한 스타일 */
        body {
            font-family: Arial, sans-serif; /* 폰트 설정 */
            display: flex; /* flexbox 레이아웃 사용 */
            flex-direction: column; /* 컬럼 방향으로 정렬 */
            align-items: center; /* 가운데 정렬 */
            height: 100vh; /* 높이를 뷰포트 높이의 100%로 설정 */
            margin: 0; /* 마진 제거 */
            background-size: cover; /* 배경 이미지 사이즈 설정 */
            background-position: center; /* 배경 이미지 위치 설정 */
            background-repeat: no-repeat; /* 배경 이미지 반복 설정 */
            background-image: url('templates/ha.png'); /* 배경 이미지 설정 */
        }

        /* 'hello-text' 클래스에 대한 스타일 */
        .hello-text {
            font-size: 48px; /* 폰트 크기 */
            color: #0c0202; /* 폰트 색상 */
            margin-top: 20vh; /* 상단 마진 */
        }

        /* 'container' 클래스에 대한 스타일 */
        .container {
            display: flex; /* flexbox 레이아웃 사용 */
            flex-direction: column; /* 컬럼 방향으로 정렬 */
            align-items: center; /* 가운데 정렬 */
        }

        /* 'dropArea' 아이디에 대한 스타일 */
        #dropArea {
            width: 320px; /* 너비 */
            height: 240px; /* 높이 */
            border: 1px dashed #000; /* 점선 테두리 */
            border-radius: 5px; /* 테두리 둥글게 */
            display: flex; /* flexbox 레이아웃 사용 */
            align-items: center; /* 가운데 정렬 */
            justify-content: center; /* 중앙 정렬 */
            margin-top: 20px; /* 상단 마진 */
        }

        /* button 태그에 대한 스타일 */
        button {
            font-size: 14px; /* 폰트 크기 */
            padding: 8px 16px; /* 패딩 */
            border: none; /* 테두리 제거 */
            border-radius: 5px; /* 테두리 둥글게 */
            background-color: #419f25; /* 배경색 */
            color: #fff; /* 폰트 색상 */
            cursor: pointer; /* 마우스 커서 변경 */
            margin-top: 16px; /* 상단 마진 */
        }

        /* button 태그에 대한 hover(마우스 오버) 효과 */
        button:hover {
            background-color: #0056b3; /* 배경색 변경 */
        }

        /* 'result' 아이디에 대한 스타일 */
        #result {
            margin-top: 20px; /* 상단 마진 */
            font-size: 16px; /* 폰트 크기 */
        }
    </style>
</head>
<body>
    <div class="hello-text">what is my dog?</div>
    
    <div class="container">
        <div id="dropArea">
            <p>여기에 파일을 끌어다 놓으세요</p>
        </div>
        <button id="uploadBtn">선택한 사진 업로드</button>
        <div id="result"></div>
        <canvas id="resultChart" width="400" height="400"></canvas>
    </div>

    <script>
        // 페이지 내의 요소를 JavaScript 변수에 연결
        const dropArea = document.getElementById('dropArea'); // 드랍 영역 선택
        const uploadBtn = document.getElementById('uploadBtn'); // 업로드 버튼 선택
        const resultDiv = document.getElementById('result'); // 결과를 표시할 div 선택
        let selectedImage = null; // 사용자가 선택한 이미지 파일을 저장할 변수
    
        // 드랍 영역에 드래그 오버 이벤트 리스너 설정
        dropArea.addEventListener('dragover', (event) => {
            event.stopPropagation(); // 이벤트 전파 중지
            event.preventDefault(); // 기본 이벤트 동작 중지
            event.dataTransfer.dropEffect = 'copy'; // 드랍 효과를 복사로 설정
        });
    
        // 드랍 영역에 드랍 이벤트 리스너 설정
        dropArea.addEventListener('drop', (event) => {
            event.stopPropagation(); // 이벤트 전파 중지
            event.preventDefault(); // 기본 이벤트 동작 중지
            const files = event.dataTransfer.files; // 드랍된 파일 목록
            if (files.length > 0) {
                selectedImage = files[0]; // 첫 번째 파일을 선택한 이미지로 설정
                displayImage(files[0]); // 이미지 표시 함수 호출
            }
        });
    
        // 이미지 파일을 읽고 표시하는 함수
        function displayImage(file) {
            const reader = new FileReader(); // FileReader 객체 생성
            reader.onload = function (event) {
                // 파일 읽기가 완료되면 실행되는 함수
                // 읽은 이미지 데이터로 img 태그를 생성하여 dropArea 안에 표시
                dropArea.innerHTML = '<img src="' + event.target.result + '" style="max-width: 100%; height: auto; border-radius: 5px;"/>';
            };
            reader.readAsDataURL(file); // 파일 데이터를 URL로 읽기
        }
    
        // 업로드 버튼 클릭 이벤트 리스너
        uploadBtn.addEventListener('click', upload);
    
        // 이미지를 서버에 업로드하는 함수
        function upload() {
            if (selectedImage) {
                const formData = new FormData(); // FormData 객체 생성
                formData.append('images[]', selectedImage); // 선택된 이미지를 FormData에 추가
    
                // fetch API를 사용하여 서버에 POST 요청 전송
                fetch('/upload', {
                    method: 'POST',
                    body: formData
                }).then(response => response.json()) // 응답을 JSON으로 파싱
                  .then(data => {
                    resultDiv.innerHTML = '<p>결과: ' + data.result + '</p>'; // 결과 표시
                    displayChart(data.result); // 차트 표시 함수 호출
                }).catch(error => {
                    console.error('Error:', error); // 오류 로깅
                    resultDiv.innerHTML = '<p>오류가 발생했습니다.</p>'; // 오류 메시지 표시
                });
            } else {
                alert('이미지를 끌어다 놓으세요.'); // 이미지가 선택되지 않았을 경우 경고
            }
        }
    
        // 결과 데이터를 바탕으로 차트를 그리는 함수
        function displayChart(resultText) {
            console.log("Chart Data: ", resultText); // 콘솔에 차트 데이터 로깅
    
            // 결과 문자열을 파싱하여 차트 데이터 생성
            const resultData = resultText.split(", ").map(item => {
                const parts = item.split(" (");
                return {
                    label: parts[0], // 레이블 (클래스 이름)
                    value: parseFloat(parts[1].slice(0, -2)) // 값 (확률)
                };
            });
    
            // 차트 생성
            const ctx = document.getElementById('resultChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar', // 차트 유형: 막대 그래프
                data: {
                    labels: resultData.map(item => item.label), // 레이블 배열
                    datasets: [{
                        label: '확률 (%)', // 데이터셋 레이블
                        data: resultData.map(item => item.value), // 데이터 배열
                        backgroundColor: 'rgba(0, 123, 255, 0.5)', // 배경색
                        borderColor: 'rgba(0, 123, 255, 1)', // 테두리 색
                        borderWidth: 1 // 테두리 두께
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true // y축을 0부터 시작
                        }
                    }
                }
            });
        }
    </script>
    <footer>team : 알파 G 메일</footer>
</body>
</html>